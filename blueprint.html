<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Your Free Blueprint - Sorta Systems</title>
    <link rel="icon" type="image/png" href="/public/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="bg-white">
    <!-- Header -->
    <header class="bg-white border-b border-gray-100 sticky top-0 z-50 backdrop-blur-sm bg-white/95">
        <div class="mx-auto max-w-7xl px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <img src="/public/logo.svg" alt="Sorta Systems" class="h-8 w-auto" />
                </div>
                <a href="/" class="inline-flex items-center justify-center rounded-md bg-[#0A74DA] px-6 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-[#085CB0] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#0A74DA] focus-visible:ring-offset-2">
                    Back to Home
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="py-16 bg-[#2C3E50]">
            <div class="mx-auto max-w-4xl px-6 text-center">
                <h1 class="text-4xl font-bold text-white mb-6 md:text-5xl">
                    Get Your Free Business Blueprint
                </h1>
                <p class="text-xl text-white/90 mb-8 md:text-2xl">
                    Tell us about your business and we'll create a custom automation plan tailored to your needs.
                </p>
            </div>
        </section>

        <!-- Form Section -->
        <section class="py-8 md:py-16" style="background-color: #F9FAFB !important;">
            <div class="mx-auto max-w-4xl px-4 md:px-6">
                <!-- Success Message (Hidden by default) -->
                <div id="success-message" class="hidden bg-green-50 border border-green-200 rounded-xl p-8 mb-8 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-green-800 mb-2">Thank You!</h2>
                    <p class="text-green-700">We've received your information and will send your custom blueprint within 48 hours.</p>
                </div>

                <!-- Form -->
                <form id="discovery-form" class="bg-white rounded-2xl shadow-lg p-6 md:p-10 lg:p-12">
                    <!-- Header -->
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-[#2C3E50] mb-4">Tell Us About Your Business</h2>
                        <p class="text-lg text-[#2C3E50]/70">This helps us create a custom automation plan tailored to your specific situation.</p>
                    </div>
                    
                    <div class="space-y-8">
                        <!-- Field 1: Business Name -->
                        <div>
                            <label for="businessName" class="block text-lg font-semibold text-[#2C3E50] mb-3">What's your business name? <span class="text-red-500">*</span></label>
                            <input type="text" id="businessName" name="businessName" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0A74DA] focus:border-transparent transition-all duration-200 text-lg"
                                   placeholder="e.g., Smith Plumbing">
                        </div>
                        
                        <!-- Field 2: Website -->
                        <div>
                            <label for="websiteUrl" class="block text-lg font-semibold text-[#2C3E50] mb-3">What's your website URL? <span class="text-red-500">*</span></label>
                            <input type="url" id="websiteUrl" name="websiteUrl" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0A74DA] focus:border-transparent transition-all duration-200 text-lg"
                                   placeholder="e.g., smithplumbing.co.uk">
                        </div>
                        
                        <!-- Field 3: Email -->
                        <div>
                            <label for="emailAddress" class="block text-lg font-semibold text-[#2C3E50] mb-3">What email should we use to send your blueprint? <span class="text-red-500">*</span></label>
                            <input type="email" id="emailAddress" name="emailAddress" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0A74DA] focus:border-transparent transition-all duration-200 text-lg"
                                   placeholder="your.email@example.com">
                        </div>
                        
                        <!-- Field 3: Time-Consuming Task -->
                        <div>
                            <label for="timeConsumingTask" class="block text-lg font-semibold text-[#2C3E50] mb-3">What's the single most time-consuming admin task stealing your evenings? <span class="text-red-500">*</span></label>
                            <textarea id="timeConsumingTask" name="timeConsumingTask" rows="3" required
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0A74DA] focus:border-transparent transition-all duration-200 text-lg resize-none"
                                      placeholder="e.g., Manually creating quotes for every enquiry - takes me 30 minutes each time and I get 10-15 per week"></textarea>
                        </div>
                        
                        <!-- Field 4: Hours Per Week -->
                        <div>
                            <label for="hoursPerWeek" class="block text-lg font-semibold text-[#2C3E50] mb-3">On average, how many hours per week do you lose to this admin work? <span class="text-red-500">*</span></label>
                            <input type="number" id="hoursPerWeek" name="hoursPerWeek" min="1" max="100" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0A74DA] focus:border-transparent transition-all duration-200 text-lg"
                                   placeholder="e.g., 15">
                        </div>
                        
                        <!-- Field 5: Successful Outcome -->
                        <div>
                            <label for="successfulOutcome" class="block text-lg font-semibold text-[#2C3E50] mb-3">If we could automate this and give you those hours back, what would you do with the extra time? <span class="text-red-500">*</span></label>
                            <textarea id="successfulOutcome" name="successfulOutcome" rows="3" required
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0A74DA] focus:border-transparent transition-all duration-200 text-lg resize-none"
                                      placeholder="e.g., Actually have dinner with my family instead of working until 9pm every night"></textarea>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center mt-12">
                        <button type="button" id="submit-btn" onclick="submitForm()"
                                class="inline-flex items-center justify-center rounded-md bg-[#0A74DA] px-8 py-4 text-lg font-semibold text-white shadow-sm transition-colors hover:bg-[#085CB0] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#0A74DA] focus-visible:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span id="submit-text">Get My Free Blueprint</span>
                            <svg id="submit-spinner" class="hidden animate-spin ml-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                        <p class="mt-4 text-sm text-[#2C3E50]/60">We'll send your custom blueprint within 48 hours</p>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <!-- Footer Placeholder -->
    <div id="footer-placeholder"></div>

    <!-- Footer Component -->
    <script src="/public/footer.js?v=1.0"></script>

    <script>
        // Form validation
        function validateForm() {
            const form = document.getElementById('discovery-form');
            
            // Check all required fields
            const businessName = document.getElementById('businessName').value.trim();
            const websiteUrl = document.getElementById('websiteUrl').value.trim();
            const emailAddress = document.getElementById('emailAddress').value.trim();
            const timeConsumingTask = document.getElementById('timeConsumingTask').value.trim();
            const hoursPerWeek = document.getElementById('hoursPerWeek').value;
            const successfulOutcome = document.getElementById('successfulOutcome').value.trim();
            
            if (!businessName || !websiteUrl || !emailAddress || !timeConsumingTask || !hoursPerWeek || !successfulOutcome) {
                alert('Please fill in all required fields.');
                return false;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailAddress)) {
                alert('Please enter a valid email address.');
                return false;
            }
            
            // Validate hours per week
            const hours = parseInt(hoursPerWeek);
            if (isNaN(hours) || hours < 1 || hours > 100) {
                alert('Please enter a valid number of hours between 1 and 100.');
                return false;
            }
            
            return true;
        }
        
        // Form submission function
        async function submitForm() {
            if (!validateForm()) {
                return;
            }
            
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const submitSpinner = document.getElementById('submit-spinner');
            const form = document.getElementById('discovery-form');
            const successMessage = document.getElementById('success-message');
            
            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = 'Creating Your Blueprint...';
            submitSpinner.classList.remove('hidden');
            
            try {
                // Gather form data
                const formData = new FormData(form);
                const data = {};
                
                // Convert FormData to object
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }
                
                // Add timestamp and metadata
                data.submissionDate = new Date().toISOString();
                data.formVersion = '2.0';
                data.userAgent = navigator.userAgent;
                data.referrer = document.referrer;
                data.timestamp = Date.now();
                
                // n8n webhook URL (production)
                const webhookUrl = 'https://n8n.secur3-et.co.uk/webhook/sortasystems-forms';
                
                // Send to n8n webhook with timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout
                
                console.log('🚀 Sending POST request to webhook...');
                console.log('📊 Data being sent:', data);
                
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data),
                    signal: controller.signal
                });
                
                console.log('✅ POST request completed!');
                console.log('📈 Response status:', response.status);
                console.log('📋 Response headers:', Object.fromEntries(response.headers.entries()));
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    // Show success message
                    form.classList.add('hidden');
                    successMessage.classList.remove('hidden');
                    
                    // Scroll to success message
                    successMessage.scrollIntoView({ behavior: 'smooth' });
                    
                    // Clear form data for security
                    form.reset();
                } else {
                    throw new Error(`Server responded with status: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Error submitting form:', error);
                console.error('Error details:', error.message);
                
                if (error.name === 'AbortError') {
                    alert('Request timed out. Please check your connection and try again.');
                } else if (error.message.includes('CORS') || error.message.includes('fetch')) {
                    alert('CORS Error: Please check your n8n webhook CORS configuration. For now, the form data has been logged to the console for testing.');
                    console.log('Form data that would have been sent:', data);
                } else {
                    alert('There was an error submitting your form. Please try again or contact us directly at hello@sortasystems.co.uk');
                }
                
                // Reset button state
                submitBtn.disabled = false;
                submitText.textContent = 'Get My Free Blueprint';
                submitSpinner.classList.add('hidden');
            }
        }
    </script>
</body>
</html>